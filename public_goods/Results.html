{{ block title }}Results{{ endblock }}

{{ block content }}

<style>
  .results-card {
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 18px;
    margin-bottom: 18px;
    background: #fff;
    box-shadow: 0 1px 2px rgba(0,0,0,0.04);
  }

  .results-title {
    margin-bottom: 14px;
    font-weight: 700;
  }

  /* Table */
  .table {
    margin-bottom: 0;
  }
  .table thead th {
    background: #f8fafc;
    font-weight: 700;
  }

  /* Breakdown */
  .breakdown {
    margin: 0;
    padding-left: 18px;
  }
  .breakdown li {
    margin-bottom: 8px;
    line-height: 1.35;
  }

  .formula {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    background: #f8fafc;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid #e5e7eb;
    display: inline-block;
    margin-top: 6px;
  }

  /* Next button spacing */
  .otree-btn-next {
    margin-top: 8px;
  }
</style>


<div class="results-card">
  <h3 class="results-title">Contributions in your group</h3>

  <table class="table table-sm">
    <thead>
      <tr>
        <th>Player</th>
        <th>Contribution</th>
      </tr>
    </thead>
    <tbody>
      {% for row in contributions_table %}
        <tr>
          <td>{{ row.id_in_group }}</td>
          <td>{{ row.contribution }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="results-card">
  <h3 class="results-title">Bar chart of contributions</h3>
  <canvas id="contribChart" height="120"></canvas>
</div>

<script>
  // Datos listos para usarse en el gráfico (se dibuja en la tarea 4)
  const labels = {{ chart_labels_json|safe }};
  const values = {{ chart_values_json|safe }};

  const ctx = document.getElementById('contribChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Contribution',
        data: values,
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
</script>

<div class="results-card">
  <h3 class="results-title">Step-by-step payoff calculation</h3>

  <ul class="breakdown">
    <li>Endowment: <b>{{ breakdown.endowment }}</b></li>
    <li>Your contribution: <b>{{ breakdown.your_contribution }}</b></li>
    <li>Total group contribution: <b>{{ breakdown.total_contribution }}</b></li>
    <li>Multiplier: <b>{{ breakdown.multiplier }}</b></li>
    <li>Players in group: <b>{{ breakdown.players_per_group }}</b></li>

    <li>
      Your share of the public return: <b>{{ breakdown.individual_share }}</b>
      <div class="formula">(Total × Multiplier) ÷ Players</div>
    </li>

    <li>
      <b>Your payoff: {{ breakdown.payoff }}</b>
      <div class="formula">Endowment − Your contribution + Your share</div>
    </li>
  </ul>
</div>


{{ next_button }}

{{ endblock }}

